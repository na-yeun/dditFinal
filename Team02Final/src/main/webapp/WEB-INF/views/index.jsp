<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %> 
<%@ taglib uri="http://www.springframework.org/security/tags" prefix="security" %> 
<link rel="stylesheet" href="${pageContext.request.contextPath}/resources/css/index.css">

<!-- CSS ÌååÏùº -->
    <link rel="stylesheet" href="https://unpkg.com/tippy.js@6/dist/tippy.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@5.8.0/main.min.css" />

    <!-- Popper.jsÏôÄ Tippy.js -->
    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="https://unpkg.com/tippy.js@6"></script>

    <!-- FullCalendar JS -->
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>

<div class="row">
	<security:authorize access="isAuthenticated()">
		<security:authentication property="principal" var="principal" />
		<c:set value="${principal.account.empName}" var="empName"></c:set>
		<c:set value="${principal.account.base64EmpImg}" var="empImg"></c:set>
		<c:set value="${principal.account.empId }" var="empId"></c:set>
		<c:set value="${principal.account.companyId }" var="companyId"></c:set>
		<c:set value="${principal.account.departCode}" var="departCode"></c:set>
		<c:set value="${principal.account.posiId}" var="posiId"></c:set>
		<c:set value="${principal.account.myComment}" var="myComment"></c:set>
	</security:authorize>
	
<input type="hidden" id="hiddenEmpId" value="${empId}"/> 
	<input type="hidden" id="hiddenDeptCode" value="${departCode}"/> 
	<input type="hidden" id="hiddenPosiId" value="${posiId}"/>	
	<!-- ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ -->
	<div class="col-md-6 row top-main">
		<div class="col-md-6">
			<div class="card myprofile">
				<div class="card-header">
					<h4 class="card-title mb-0">üë§ÎÇòÏùò ÌîÑÎ°úÌïÑüë§</h4>
				</div>
				<div class="card-body profile-body">
					<div class="profile-info">
						<c:if test="${not empty empImg}">
							<img src="data:image/*;base64,${empImg}" alt="ÌîÑÎ°úÌïÑ Ïù¥ÎØ∏ÏßÄ"
								class="rounded-circle myimg" />
						</c:if>
						<c:if test="${empty empImg}">
							<img src="${pageContext.request.contextPath}/resources/images/profile-img.jpg"
								alt="Í∏∞Î≥∏ ÌîÑÎ°úÌïÑ Ïù¥ÎØ∏ÏßÄ" class="rounded-circle myimg" />
						</c:if>
						<table class="my-info-table">
							<tr>
								<td>üó®Ô∏èÏÜåÏÜçüó®Ô∏è</td>
								<td><strong class="myDept"></strong></td>
							</tr>
							<tr>
								<td>üó®Ô∏èÏù¥Î¶Ñüó®Ô∏è</td>
								<td>${empName}</td>
							</tr>
						</table>
						<p id="comment-p-tag">
							<span id="my-comment-area">${myComment}</span>
							<a href="javascript:void(0);" onclick="editMyComent()">
								<img class="icon" alt="ÏÇ≠Ï†ú" src="${pageContext.request.contextPath}/resources/images/edit-icon.png"/>
							</a>
						</p>
						
					</div>
					<div class="attendance-info">
						<table class="table">
							<tr>
								<td>Ï∂úÍ∑º</td>
								<td><span id="startTime"></span></td>
							</tr>
							<tr>
								<td>Ìá¥Í∑º</td>
								<td><span id="endTime"></span></td>
							</tr>
						</table>
						<div class="mt-3">
							<button id="startWorkBtn" class="btn btn-primary btn-sm">Ï∂úÍ∑º</button>
							<button id="endWorkBtn" class="btn btn-secondary btn-sm">Ìá¥Í∑º</button>
							<button id="endWorkLogoutBtn" class="btn btn-danger btn-sm">Ìá¥Í∑º
								Î∞è Î°úÍ∑∏ÏïÑÏõÉ</button>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- to do list -->
		<div class="col-md-6">
			<div class="card todo-list">
				<div class="card-header">
					<h4 class="card-title mb-0">‚úÖÏò§ÎäòÏùò Ìï† Ïùº‚úÖ</h4>
				</div>
				<div class="card-body">
					<div class="list-group">
						<c:if test="${not empty mainPageData.toDoListList}">
							<c:forEach items="${mainPageData.toDoListList}" var="mydo" varStatus="status">
								<c:if test="${mydo.todoStatus eq 'N'}"> <!-- ÏôÑÎ£å ÏïÑÎãê Îïå -->
									<c:if test="${mydo.todoPriority eq 1}"> <!-- Ï§ëÏöîÎèÑ ÎÇÆÏùÑ Îïå -->
										<div class="todo-one todo-row" id="${mydo.todoNo}" data-priority="${mydo.todoPriority}">
											<input type="checkbox" class="todo-check" id="todo-check-${mydo.todoNo}">
											<span data-content="${mydo.todoContent}">${mydo.todoContent}</span>
											<a href="javascript:void(0);" onclick="editToDo('${mydo.todoNo}')">
												<img class="icon" alt="ÏÇ≠Ï†ú" src="${pageContext.request.contextPath}/resources/images/edit-icon.png"/>
											</a>
											<a href="javascript:void(0);" onclick="deleteToDo('${mydo.todoNo}')">
												<img class="icon" alt="ÏÇ≠Ï†ú" src="${pageContext.request.contextPath}/resources/images/delete-icon.png"/>
											</a>
										</div>
									</c:if>
									<c:if test="${mydo.todoPriority eq 2}"> <!-- Ï§ëÏöîÎèÑ Î≥¥ÌÜµÏùº Îïå -->
										<div class="todo-one todo-normal" id="${mydo.todoNo}" data-priority="${mydo.todoPriority}">
											<input type="checkbox" class="todo-check" id="todo-check-${mydo.todoNo}">
											<span data-content="${mydo.todoContent}">${mydo.todoContent}</span>
											<a href="javascript:void(0);" onclick="editToDo('${mydo.todoNo}')">
												<img class="icon" alt="ÏÇ≠Ï†ú" src="${pageContext.request.contextPath}/resources/images/edit-icon.png"/>
											</a>
											<a href="javascript:void(0);" onclick="deleteToDo('${mydo.todoNo}')">
												<img class="icon" alt="ÏÇ≠Ï†ú" src="${pageContext.request.contextPath}/resources/images/delete-icon.png"/>
											</a>
										</div>
									</c:if>
									<c:if test="${mydo.todoPriority eq 3}"> <!-- Ï§ëÏöîÎèÑ ÎÜíÏùÑ Îïå -->
										<div class="todo-one todo-high" id="${mydo.todoNo}" data-priority="${mydo.todoPriority}">
											<input type="checkbox" class="todo-check" id="todo-check-${mydo.todoNo}">
											<span data-content="${mydo.todoContent}">üö® ${mydo.todoContent}</span>
											<a href="javascript:void(0);" onclick="editToDo('${mydo.todoNo}')">
												<img class="icon" alt="ÏÇ≠Ï†ú" src="${pageContext.request.contextPath}/resources/images/edit-icon.png"/>
											</a>
											<a href="javascript:void(0);" onclick="deleteToDo('${mydo.todoNo}')">
												<img class="icon" alt="ÏÇ≠Ï†ú" src="${pageContext.request.contextPath}/resources/images/delete-icon.png"/>
											</a>
										</div>
									</c:if>
								</c:if>
								
								<c:if test="${mydo.todoStatus eq 'Y'}"> <!-- ÏôÑÎ£åÏùº Îïå -->
									<c:if test="${mydo.todoPriority eq 1}">
										<div class="todo-one todo-row todo-done" id="${mydo.todoNo}" data-priority="${mydo.todoPriority}">
											<input type="checkbox" class="todo-check" id="todo-check-${mydo.todoNo}" checked>
											<span data-content="${mydo.todoContent}">${mydo.todoContent}</span>
											<a href="javascript:void(0);" onclick="editToDo('${mydo.todoNo}')">
												<img class="icon" alt="ÏÇ≠Ï†ú" src="${pageContext.request.contextPath}/resources/images/edit-icon.png"/>
											</a>
											<a href="javascript:void(0);" onclick="deleteToDo('${mydo.todoNo}')">
												<img class="icon" alt="ÏÇ≠Ï†ú" src="${pageContext.request.contextPath}/resources/images/delete-icon.png"/>
											</a>
										</div>
									</c:if>
									<c:if test="${mydo.todoPriority eq 2}">
										<div class="todo-one todo-normal todo-done" id="${mydo.todoNo}" data-priority="${mydo.todoPriority}">
											<input type="checkbox" class="todo-check" id="todo-check-${mydo.todoNo}" checked>
											<span data-content="${mydo.todoContent}">${mydo.todoContent}</span>
											<a href="javascript:void(0);" onclick="editToDo('${mydo.todoNo}')">
												<img class="icon" alt="ÏÇ≠Ï†ú" src="${pageContext.request.contextPath}/resources/images/edit-icon.png"/>
											</a>
											<a href="javascript:void(0);" onclick="deleteToDo('${mydo.todoNo}')">
												<img class="icon" alt="ÏÇ≠Ï†ú" src="${pageContext.request.contextPath}/resources/images/delete-icon.png"/>
											</a>
										</div>
									</c:if>
									<c:if test="${mydo.todoPriority eq 3}">
										<div class="todo-one todo-high todo-done" id="${mydo.todoNo}" data-priority="${mydo.todoPriority}">
											<input type="checkbox" class="todo-check" id="todo-check-${mydo.todoNo}" checked>
											<span data-content="${mydo.todoContent}">üö® ${mydo.todoContent}</span>
											<a href="javascript:void(0);" onclick="editToDo('${mydo.todoNo}')">
												<img class="icon" alt="ÏÇ≠Ï†ú" src="${pageContext.request.contextPath}/resources/images/edit-icon.png"/>
											</a>
											<a href="javascript:void(0);" onclick="deleteToDo('${mydo.todoNo}')">
												<img class="icon" alt="ÏÇ≠Ï†ú" src="${pageContext.request.contextPath}/resources/images/delete-icon.png"/>
											</a>
										</div>
									</c:if>
									
								</c:if>
							</c:forEach>
						</c:if>
						<c:if test="${empty mainPageData.toDoListList}">
							
						</c:if>
					</div>
					<div class="todo-btn">
						<button class="btn btn-outline-primary btn-sm mt-3" id="todo-plus-btn">Ï∂îÍ∞Ä</button>
					</div>
				</div>
			</div>
		</div>
				
		<div class="col-md-6">
			<div class="card team-status">
				<div class="card-header">
					<h4 class="card-title mb-0">‚ùåÍ∏àÏùº ÌåÄ Ìú¥Í∞ÄÏûê‚ùå</h4>
				</div>
				<div class="card-body">
					<c:if test="${not empty vacationList}">
						<c:forEach items="${vacationList}" var="vacation">
							<p><b>${vacation.posiName}</b> ${vacation.empName}</p>
						</c:forEach>
					</c:if>
					<c:if test="${empty vacationList}">
						<p>Í∏àÏùº Ìú¥Í∞ÄÏûê ÏóÜÏùå</p>
					</c:if>
				</div>
			</div>
		</div>
		<div class="col-md-6">
		    <div class="card team-status">
		        <div class="card-header">
		            <h4 class="card-title mb-0">üìÉÎÇòÏùò ÌîÑÎ°úÏ†ùÌä∏üìÉ</h4>
		        </div>
		        <div class="card-body">
		            <c:choose>
		                <c:when test="${not empty mainPageData.projectList}">
		                    <c:forEach items="${mainPageData.projectList}" var="proj" varStatus="status">
		                        <c:if test="${status.index < 3}">
		                            <div style="display: flex; justify-content: space-between; align-items: center;">
		                                <a href="${pageContext.request.contextPath}/${companyId}/project/${proj.projId}" style="text-decoration: none;">
		                                    ${proj.projTitle}
		                                </a>
		                                <c:if test="${proj.projectDto.codeComment eq 'ÏòàÏ†ï'}">
		                                    <span class="badge bg-secondary">${proj.projectDto.codeComment}</span>
		                                </c:if>
		                                <c:if test="${proj.projectDto.codeComment eq 'ÏßÑÌñâÏ§ë'}">
		                                    <span class="badge bg-success">${proj.projectDto.codeComment}</span>
		                                </c:if>
		                                <c:if test="${proj.projectDto.codeComment eq 'Ï¢ÖÎ£å'}">
		                                    <span class="badge bg-dark">${proj.projectDto.codeComment}</span>
		                                </c:if>
		                            </div>
		                            <br/>
		                        </c:if>
		                    </c:forEach>
		                </c:when>
		                <c:otherwise>
		                    <p>ÏïÑÏßÅ Ï∞∏Í∞ÄÎêú ÌîÑÎ°úÏ†ùÌä∏Í∞Ä ÏóÜÏäµÎãàÎã§.</p>
		                </c:otherwise>
		            </c:choose>
		        </div>
		    </div>
		</div>
	</div>

	<!-- Ï∫òÎ¶∞Îçî -->
	<div class="col-md-6 row top-main">
		<div class="col-md-12">
			<div class="card calendar-container">
				<div class="card-header">
					<%-- <h4 class="card-title mb-0">üìÜ${mainPageData.nowYear}ÎÖÑ
						${mainPageData.nowMonth}ÏõîüìÜ</h4> --%>
						<button class="btn btn-outline-primary btn-sm float-end"
						onclick="location.href='${pageContext.request.contextPath}/${companyId}/schedule/cal'">Ï†ÑÏ≤¥Î≥¥Í∏∞</button>
				<br>
				</div>
				<div class="card-body">	<!-- Ï∫òÎ¶∞Îçî ÎÇ¥Ïö© -->
					<div>
						<main class="calendar-container">
							<div id="calendarMain"></div>
						</main>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<!-- to do list Î™®Îã¨ -->
<div class="modal fade" id="todolistModal" tabindex="-1" aria-labelledby="todolistModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="todolistModalLabel">Ïò§Îäò Ìï† Ïùº</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form id="todo-plus-form" action="${pageContext.request.contextPath}/${companyId}/todo">
	      <div class="modal-body">
	      	<div style="text-align: right;">
				<button type="button" class="btn btn-outline-dark btn-sm" id="insert-todo-btn">Îç∞Ïù¥ÌÑ∞ÏÇΩÏûÖ</button>
			</div>
	      	<p class="todo-list-info">Ï∂îÍ∞ÄÌïòÏãúÎäî Ìï† ÏùºÏùÄ ÎÇ¥ÏùºÏù¥ ÎêòÎ©¥ ÏûêÎèôÏúºÎ°ú ÏÇ≠Ï†úÎê©ÎãàÎã§.</p>
	      	<table class="table">
	      		<tr style="display:none;">
	      			<td>Ìï† Ïùº ID</td>
	      			<td>
	      				<input id="todoNo" type="text" class="form-control" name="todoNo">
	      			</td>
	      		</tr>
	      		<tr>
	      			<td>Ìï† Ïùº</td>
	      			<td>
	      				<input id="todoContent" type="text" class="form-control" name="todoContent" placeholder="30Ïûê Ïù¥ÎÇ¥Î°ú ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî.">
	      			</td>
	      		</tr>
	      		<tr>
	      			<td>Ï§ëÏöîÎèÑ</td>
	      			<td>
	      				<select id="todoPriority" class="form-control" name="todoPriority">
	      					<option value>Ï§ëÏöîÎèÑÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.</option>
	      					<option value="1">ÎÇÆÏùå</option>
	      					<option value="2">Î≥¥ÌÜµ</option>
	      					<option value="3">ÎÜíÏùå</option>
	      				</select>
	      			</td>
	      		</tr>
	      	</table>
	      </div>
	      <div class="modal-footer">
	        <button type="submit" class="btn btn-primary">Ï†ÄÏû•</button>
	        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ï∑®ÏÜå</button>
	      </div>
      </form>
    </div>
  </div>
</div>

<!-- my comment ÏàòÏ†ï Ìèº -->
<div class="modal fade" id="myCommentModal" tabindex="-1" aria-labelledby="myCommentModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="myCommentModalLabel">Î©òÌä∏ ÏàòÏ†ï</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form id="my-comment-form" action="${pageContext.request.contextPath}/${companyId}/main/comment">
	      <div class="modal-body">
	      	<table class="table">
	      		<tr>
	      			<td>Î©òÌä∏</td>
	      			<td>
	      				<input id="myComment" type="text" class="form-control" name="myComment" placeholder="30Ïûê Ïù¥ÎÇ¥Î°ú ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî.">
	      			</td>
	      		</tr>
	      	</table>
	      </div>
	      <div class="modal-footer">
	        <button type="submit" class="btn btn-primary">Ï†ÄÏû•</button>
	        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ï∑®ÏÜå</button>
	      </div>
      </form>
    </div>
  </div>
</div>



<script> 
//jsÏóêÏÑú ÏÇ¨Ïö©ÌïòÍ∏∞ ÏúÑÌï¥ ÎΩëÏïÑÎ≤ÑÎ¶º (ÎØºÏû¨)
	const contextPath="${pageContext.request.contextPath}";
	const companyId="${companyId}";
	const empId="${empId}";
	const myComment="${myComment}";
	
	
</script>
<!-- Ï∂úÍ∑º Ìá¥Í∑º Ìá¥Í∑ºÎ∞è Î°úÍ∑∏ÏïÑÏõÉ Í∑ºÌÉú Ï≤òÎ¶¨ Ïä§ÌÅ¨Î¶ΩÌä∏ ÌååÏùº (ÎØºÏû¨) -->
<script src="${pageContext.request.contextPath }/resources/js/app/mainpage/startEndWork.js"></script>
<script src="${pageContext.request.contextPath }/resources/js/app/mainpage/sidebar.js"></script>
<script src="${pageContext.request.contextPath }/resources/js/app/mainpage/todolist.js"></script>
<script src="${pageContext.request.contextPath }/resources/js/app/mainpage/myComment.js"></script>
<script src="${pageContext.request.contextPath }/resources/js/app/schedule/scheduleCalendarMain.js"></script>





